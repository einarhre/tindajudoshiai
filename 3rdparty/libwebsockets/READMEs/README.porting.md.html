<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.porting</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<h1 id="guidance-for-porting-to-new-platform">Guidance for porting to new platform</h1>
<p>Where differences existed between the initial POSIX platform for lws and other supported platforms like Windows, <code>lws_plat_...()</code> apis were added to move handling to platform-specific code in <code>./lib/plat/</code>.</p>
<p>Depending o which platform is built, different platform-specific implementations of these <code>lws_plat...()</code> apis get built.</p>
<h2 id="prepare-the-cmake-cross-build-file-if-necessary">1) Prepare the cmake cross-build file if necessary</h2>
<p>CMake isolates its settings for cross-build into a separate file, which can be used to different cmake projects for the same platform as well.</p>
<p>Find a similar examples already in <code>./contrib/cross-*</code> and copy and adapt it as needed,</p>
<p>All settings related to toolchain should go in there. For cross-toolchain, the convention is to pass the path to its installed directory in <code>CROSS_PATH</code> environment variable.</p>
<h2 id="copy-the-closest-platform-dir-in-.libplat">2) Copy the closest platform dir in ./lib/plat</h2>
<p>Wholesale copy the closest existing platform dir to <code>/lib/plat/myplatform</code> and rename the files.</p>
<p>Remove stuff specific to the original platform.</p>
<h2 id="add-a-flag-in-cmakelists.txt">3) Add a flag in CMakeLists.txt</h2>
<p>Cut and paste a flag to select your platform, preferably <code>LWS_PLAT_MYPLATFORM</code> or so</p>
<h2 id="add-a-section-to-force-select-and-deselect-other-cmake-options-based-on-platform-flag">4) Add a section to force-select and deselect other cmake options based on platform flag</h2>
<p>Some options on by default may not make sense on your platform, and others off by default may be mandatory. After the options() section in CMakeLists.txt, you can use this kind of structure</p>
<pre><code>    if (LWS_PLAT_MYPLATFORM)
        set(LWS_WITH_XXXX 0)
    endif()</code></pre>
<p>to enforce implicit requirements of your platform. Optional stuff should be set by running cmake commandline as usual.</p>
<h2 id="add-building-your-platform-files-into-cmakelists.txt">5) Add building your platform files into CMakeLists.txt</h2>
<p>Add entries in CMakeLists.txt for building stuff in <code>./lib/plat/myplatform</code> when <code>LWS_PLAT_MYPLATFORM</code> is enabled.</p>
<h2 id="adapt-your-copied-.libplatmyplatform-files">6) Adapt your copied ./lib/plat/myplatform/ files</h2>
<p>You can now do test builds using the cross-build file, your platform flag in cmake, and your copied ./lib/plat contentâ€¦ this last part since it was copied from another platform will initially be a plentiful source of errors.</p>
<p>You can iteratively build and adapt the platform files.</p>
</body>
</html>
